{# Historial de reportes de un alumno (informativo, conductual, progress) #}
<table class="table table-striped table-sm">
    <thead>
        <tr>
            <th>Estudiante</th>
            <th>Tipo</th>
            <th>Fecha</th>
            <th>Docente</th>
            <th>Grado</th>
            <th>Estado</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
    {% for r in informativos %}
        <tr>
            <td>{{ r.alumno_nombre }}</td>
            <td><span class="badge bg-info">Informativo</span></td>
            <td>{{ r.fecha|date:"d/m/Y" }}</td>
            <td>{{ r.docente }}</td>
            <td>{{ r.grado }}</td>
            <td><span class="badge bg-success">Activo</span></td>
            <td>
                <a href="{% url 'descargar_pdf_informativo' r.pk %}" class="btn btn-secondary btn-sm" title="PDF Informativo" target="_blank">
                    <i class="bi bi-file-earmark-text"></i>
                </a>
            </td>
        </tr>
    {% endfor %}
    {% for r in conductuales %}
        <tr>
            <td>{{ r.alumno_nombre }}</td>
            <td><span class="badge bg-warning text-dark">Conductual</span></td>
            <td>{{ r.fecha|date:"d/m/Y" }}</td>
            <td>{{ r.docente }}</td>
            <td>{{ r.grado }}</td>
            <td><span class="badge bg-success">Activo</span></td>
            <td>
                <a href="{% url 'descargar_pdf_conductual' r.pk %}" class="btn btn-secondary btn-sm" title="PDF Conductual Individual" target="_blank">
                    <i class="bi bi-file-earmark"></i>
                </a>
                {# Botón 3 strikes SOLO en la última fila si hay 3 o más #}
                {% if forloop.last and conductuales|length >= 3 %}
                <a href="{% url 'descargar_pdf_conductual_3_strikes' r.pk %}" class="btn btn-warning btn-sm" title="PDF 3 Strikes" target="_blank">
                    <i class="bi bi-files"></i>
                </a>
                {% endif %}
            </td>
        </tr>
    {% endfor %}
    {% for r in progress %}
        <tr>
            <td>{{ r.alumno_nombre }}</td>
            <td><span class="badge bg-primary">Progress</span></td>
            <td>{{ r.fecha|date:"d/m/Y" }}</td>
            <td>{{ r.usuario }}</td>
            <td>{{ r.grado }}</td>
            <td><span class="badge bg-success">Activo</span></td>
            <td>
                <a href="{% url 'descargar_pdf_progress' r.pk %}" class="btn btn-secondary btn-sm" title="PDF Progress" target="_blank">
                    <i class="bi bi-file-earmark-bar-graph"></i>
                </a>
            </td>
        </tr>
    {% endfor %}
    {% if informativos|length == 0 and conductuales|length == 0 and progress|length == 0 %}
        <tr>
            <td colspan="7" class="text-center text-muted">Sin reportes registrados para este alumno.</td>
        </tr>
    {% endif %}
    </tbody>
</table>
