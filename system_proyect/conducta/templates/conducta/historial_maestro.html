{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Historial de Reportes – Maestro</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap CSS & Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{% static 'conducta/css/historial.css' %}">
</head>
<body>
    <div class="historial-container">
        <ul class="nav nav-tabs mb-3" id="reportTabs" role="tablist">
            <!-- TAB 1: TICKETS -->
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="tab-tickets" data-bs-toggle="tab" data-bs-target="#tickets" type="button" role="tab">Tickets</button>
            </li>
            <!-- TAB 2: INFORMATIVO -->
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="tab-informativo" data-bs-toggle="tab" data-bs-target="#informativo" type="button" role="tab">Reporte Informativo</button>
            </li>
            <!-- TAB 3: CONDUCTUAL -->
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="tab-conductual" data-bs-toggle="tab" data-bs-target="#conductual" type="button" role="tab">Reporte Conductual</button>
            </li>
            <!-- TAB 4: PROGRESS (solo BL) -->
            {% if area == "bilingue" %}
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="tab-progress" data-bs-toggle="tab" data-bs-target="#progress" type="button" role="tab">Progress Report</button>
            </li>
            {% endif %}
        </ul>

        <div class="tab-content" id="reportTabsContent">
            <!-- TAB 1: TICKETS -->
            <div class="tab-pane fade show active" id="tickets" role="tabpanel">
                <h5 class="mb-3">Historial de Tickets</h5>
                <div class="table-responsive">
                    <table class="table table-hover align-middle table-bordered" id="tabla-tickets">
                        <thead>
                            <tr class="table-secondary">
                                <th>TICKET ID</th>
                                <th>NOMBRE</th>
                                <th>EMAIL</th>
                                <th>DESCRIPCIÓN</th>
                                <th>ADJUNTO</th>
                                <th>ESTADO</th>
                                <th>COMENTARIOS</th>
                            </tr>
                        </thead>
                        <tbody>
                        {% for t in tickets_usuario %}
                            <tr>
                                <td>
                                    <!-- MODAL SWEETALERT2 AL CLIC -->
                                    <a href="#" class="link-ticket"
                                        data-ticket-id="{{ t.ticket_id }}"
                                        data-name="{{ t.name }}"
                                        data-email="{{ t.email }}"
                                        data-description="{{ t.description|escapejs }}"
                                        data-adjunto="{% if t.attachment %}{{ t.attachment.url }}{% endif %}"
                                        data-fecha="{{ t.fecha_creacion|date:'d/m/Y H:i' }}"
                                        data-status="{{ t.status }}">
                                        {{ t.ticket_id }}
                                    </a>
                                </td>
                                <td>{{ t.name }}</td>
                                <td>{{ t.email }}</td>
                                <td>
                                    <span class="text-truncate d-inline-block" style="max-width:150px;">
                                        {{ t.description|truncatechars:30 }}
                                    </span>
                                </td>
                                <td>
                                    {% if t.attachment %}
                                        <a href="{{ t.attachment.url }}" target="_blank" class="btn btn-sm btn-outline-secondary">Ver</a>
                                    {% else %}
                                        <span class="text-muted">No</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <span class="badge bg-info text-dark">{{ t.status }}</span>
                                </td>
                                <td>
                                    <!-- BOTÓN CHAT CON MODAL DE BIENVENIDA -->
                                    <a href="{% url 'ticket_comments' t.id %}"
                                        class="btn btn-sm btn-outline-primary btn-chat"
                                        data-ticket-id="{{ t.id }}"
                                        data-nombre="{{ t.name }}">
                                        <i class="bi bi-chat-dots"></i> Chat
                                    </a>
                                </td>
                            </tr>
                        {% empty %}
                            <tr><td colspan="7" class="text-center">No hay tickets registrados.</td></tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- Las demás pestañas (informativo, conductual, progress) siguen igual... -->
            <!-- ... -->
        </div>
        <a class="btn-dashboard text-center mt-4" href="/conducta/dashboard/maestro/">
            &larr; Regresar al Dashboard
        </a>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="{% static 'conducta/js/historial.js' %}"></script>
</body>
</html>
