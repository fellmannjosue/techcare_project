{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel Principal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="{% static 'accounts/img/nuevo.ico' %}" type="image/x-icon" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'accounts/css/menu.css' %}">
</head>
<body class="bg-light">
<div class="d-flex" id="wrapper">
  <!-- Sidebar -->
  <nav class="bg-dark text-white sidebar flex-shrink-0 p-3" style="min-width:230px;">
    <div class="d-flex align-items-center mb-3">
      <img src="{% static 'accounts/img/ana-transformed.png' %}" alt="Logo" style="width:42px;" class="me-2">
      <span class="fs-5 fw-bold">TechCare</span>
    </div>
    <hr class="text-secondary">
    <ul class="nav nav-pills flex-column mb-auto">

      <!-- Tickets -->
      {% if show_tickets %}
      <li>
        <a href="{% url 'technician_dashboard' %}" class="nav-link text-white">
          <i class="fa-solid fa-ticket-alt me-2"></i> Tickets
        </a>
      </li>
      {% endif %}

      <!-- Inventario con submenú -->
      {% if show_inventory %}
      <li>
        <a class="nav-link text-white d-flex justify-content-between align-items-center"
           data-bs-toggle="collapse" href="#submenuInventario" role="button"
           aria-expanded="false" aria-controls="submenuInventario">
          <span><i class="fa-solid fa-boxes-stacked me-2"></i> Inventario</span>
          <i class="fa fa-angle-down"></i>
        </a>
        <div class="collapse" id="submenuInventario">
          <ul class="list-unstyled ps-4">
            <li><a href="{% url 'inventario:dashboard' %}" class="nav-link"><i class="fa-regular fa-circle me-2"></i> Panel Inventario</a></li>
        </div>
      </li>
      {% endif %}

      <!-- Sponsors con submenú -->
      {% if show_sponsors %}
      <li>
        <a class="nav-link text-white d-flex justify-content-between align-items-center"
           data-bs-toggle="collapse" href="#submenuSponsors" role="button"
           aria-expanded="false" aria-controls="submenuSponsors">
          <span><i class="fa-solid fa-hand-holding-heart me-2"></i> Sponsors</span>
          <i class="fa fa-angle-down"></i>
        </a>
        <div class="collapse" id="submenuSponsors">
          <ul class="list-unstyled ps-4">
            <li><a href="{% url 'sponsors:sponsors_dashboard' %}" class="nav-link"><i class="fa-regular fa-circle me-2"></i> Dashboard Sponsors</a>
          </ul>
        </div>
      </li>
      {% endif %}

      <!-- Seguridad con submenú -->
      {% if show_seguridad %}
      <li>
        <a class="nav-link text-white d-flex justify-content-between align-items-center"
           data-bs-toggle="collapse" href="#submenuSeguridad" role="button"
           aria-expanded="false" aria-controls="submenuSeguridad">
          <span><i class="fa-solid fa-shield-halved me-2"></i> Seguridad</span>
          <i class="fa fa-angle-down"></i>
        </a>
        <div class="collapse" id="submenuSeguridad">
          <ul class="list-unstyled ps-4">
            <li><a href="{% url 'seguridad:dashboard' %}" class="nav-link"><i class="fa-regular fa-circle me-2"></i> Dashboard Seguridad</a></li>
        </div>
      </li>
      {% endif %}

      <!-- Enfermería con submenú -->
      {% if show_enfermeria %}
      <li>
        <a class="nav-link text-white d-flex justify-content-between align-items-center"
           data-bs-toggle="collapse" href="#submenuEnfermeria" role="button"
           aria-expanded="false" aria-controls="submenuEnfermeria">
          <span><i class="fa-solid fa-notes-medical me-2"></i> Enfermería</span>
          <i class="fa fa-angle-down"></i>
        </a>
        <div class="collapse" id="submenuEnfermeria">
          <ul class="list-unstyled ps-4">
            <li><a href="{% url 'enfermeria:enfermeria_dashboard' %}" class="nav-link"><i class="fa-regular fa-circle me-2"></i> Panel Enfermería</a></li>
          </ul>
        </div>
      </li>
      {% endif %}

      <!-- Mantenimiento -->
      {% if show_maintenance %}
      <li>
        <a href="{% url 'mantenimiento:maintenance_dashboard' %}" class="nav-link text-white">
          <i class="fa-solid fa-screwdriver-wrench me-2"></i> Mantenimiento
        </a>
      </li>
      {% endif %}

      <!-- Citas BL (individual) -->
      {% if show_citas_bl %}
      <li>
        <a href="{% url 'dashboard_bl' %}" class="nav-link text-white">
          <i class="fa-solid fa-calendar-check me-2"></i> Citas BL
        </a>
      </li>
      {% endif %}
      <!-- Citas COL/VOC (individual) -->
      {% if show_citas_col %}
      <li>
        <a href="{% url 'dashboard_col' %}" class="nav-link text-white">
          <i class="fa-solid fa-calendar-days me-2"></i> Citas COL/VOC
        </a>
      </li>
      {% endif %}

      <!-- Coord. Bilingüe -->
      {% if show_coordinador_bilingue %}
      <li>
        <a href="{% url 'dashboard_coordinador' area='bilingue' %}" class="nav-link text-white">
          <i class="fa-solid fa-chalkboard-user me-2"></i> Coord. Bilingüe
        </a>
      </li>
      {% endif %}
      <!-- Coord. Colegio -->
      {% if show_coordinador_colegio %}
      <li>
        <a href="{% url 'dashboard_coordinador' area='colegio' %}" class="nav-link text-white">
          <i class="fa-solid fa-user-tie me-2"></i> Coord. Colegio
        </a>
      </li>
      {% endif %}
    </ul>
    <hr class="text-secondary">
    <div class="dropdown">
      <a href="#" class="d-flex align-items-center text-white text-decoration-none dropdown-toggle" data-bs-toggle="dropdown">
        <img src="{% static 'accounts/img/user.png' %}" alt="" width="32" height="32" class="rounded-circle me-2">
        <strong>{{ request.user.username }}</strong>
      </a>
      <ul class="dropdown-menu dropdown-menu-dark text-small shadow">
        <li><a class="dropdown-item" href="{% url 'admin:index' %}"><i class="fa fa-cog me-2"></i> Admin</a></li>
        <li><hr class="dropdown-divider"></li>
        <li><a class="dropdown-item" href="{% url 'logout' %}"><i class="fa fa-sign-out-alt me-2"></i> Cerrar Sesión</a></li>
      </ul>
    </div>
  </nav>
  <!-- /Sidebar -->

  <!-- Main content -->
  <div class="flex-grow-1 d-flex flex-column min-vh-100">
    <!-- Header -->
    <nav class="navbar navbar-light bg-white shadow-sm px-3">
      <div class="container-fluid">
        <div class="navbar-brand d-flex align-items-center gap-3">
          <span class="fs-4">Panel Principal</span>
        </div>
        <div class="d-flex align-items-center gap-3">
          <!-- Notificaciones -->
          <div class="dropdown">
            <a href="#" id="notifDropdownToggle" data-bs-toggle="dropdown" aria-expanded="false" class="position-relative">
              <i class="fa-solid fa-bell fa-lg"></i>
              {% if citas_pendientes or tickets_pendientes %}
              <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                {{ citas_pendientes|add:tickets_pendientes }}
              </span>
              {% endif %}
            </a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="notifDropdownToggle">
              <li class="dropdown-header">Notificaciones recientes</li>
              {% if citas_pendientes %}
              <li>
                <a class="dropdown-item" href="{% url 'dashboard_bl' %}">
                  <i class="fa fa-calendar-check text-primary me-2"></i> {{ citas_pendientes }} cita(s) pendiente(s)
                </a>
              </li>
              {% endif %}
              {% if tickets_pendientes %}
              <li>
                <a class="dropdown-item" href="{% url 'technician_dashboard' %}">
                  <i class="fa fa-ticket-alt text-warning me-2"></i> {{ tickets_pendientes }} ticket(s) pendiente(s)
                </a>
              </li>
              {% endif %}
              {% if not citas_pendientes and not tickets_pendientes %}
              <li>
                <span class="dropdown-item text-muted">Sin nuevas notificaciones.</span>
              </li>
              {% endif %}
            </ul>
          </div>
        </div>
      </div>
    </nav>
    <!-- /Header -->

    <!-- Cards de resumen -->
    <div class="container-fluid my-4">
      <div class="row g-3">
        {% if show_tickets %}
        <div class="col-12 col-md-3">
          <div class="card border-0 shadow-sm bg-primary text-white h-100">
            <div class="card-body d-flex flex-column align-items-start">
              <div class="mb-2"><i class="fa-solid fa-ticket-alt fa-2x"></i></div>
              <div class="card-title">Tickets abiertos</div>
              <h3>{{ tickets_pendientes|default:"0" }}</h3>
              <span class="small">Pendientes de resolver</span>
            </div>
          </div>
        </div>
        {% endif %}
        {% if show_citas_bl or show_citas_col %}
        <div class="col-12 col-md-3">
          <div class="card border-0 shadow-sm bg-success text-white h-100">
            <div class="card-body d-flex flex-column align-items-start">
              <div class="mb-2"><i class="fa-solid fa-calendar-check fa-2x"></i></div>
              <div class="card-title">Citas próximas</div>
              <h3>{{ citas_pendientes|default:"0" }}</h3>
              <span class="small">Por atender</span>
            </div>
          </div>
        </div>
        {% endif %}
        {% if show_inventory %}
        <div class="col-12 col-md-3">
          <div class="card border-0 shadow-sm bg-info text-white h-100">
            <div class="card-body d-flex flex-column align-items-start">
              <div class="mb-2"><i class="fa-solid fa-boxes-stacked fa-2x"></i></div>
              <div class="card-title">Inventario</div>
              <h3>{{ inventario_total|default:"—" }}</h3>
              <span class="small">Activos registrados</span>
            </div>
          </div>
        </div>
        {% endif %}
        {% if show_sponsors %}
        <div class="col-12 col-md-3">
          <div class="card border-0 shadow-sm bg-warning text-white h-100">
            <div class="card-body d-flex flex-column align-items-start">
              <div class="mb-2"><i class="fa-solid fa-hand-holding-heart fa-2x"></i></div>
              <div class="card-title">Sponsors</div>
              <h3>{{ sponsors_total|default:"—" }}</h3>
              <span class="small">Activos</span>
            </div>
          </div>
        </div>
        {% endif %}
      </div>
    </div>
    <!-- /Cards de resumen -->

    <!-- Menú principal tipo grid de iconos -->
    <div class="container pb-5">
      <div class="row row-cols-2 row-cols-md-4 g-4 justify-content-center">
        {% if show_tickets %}
        <div class="col">
          <div class="card menu-item shadow-sm h-100 text-center" onclick="window.location='{% url 'technician_dashboard' %}'">
            <div class="card-body">
              <i class="fa-solid fa-ticket-alt fa-2x mb-2"></i>
              <div>Sistema de Tickets</div>
            </div>
          </div>
        </div>
        {% endif %}
        {% if show_inventory %}
        <div class="col">
          <div class="card menu-item shadow-sm h-100 text-center" onclick="window.location='{% url 'inventario:dashboard' %}'">
            <div class="card-body">
              <i class="fa-solid fa-boxes-stacked fa-2x mb-2"></i>
              <div>Inventario</div>
            </div>
          </div>
        </div>
        {% endif %}
        {% if show_maintenance %}
        <div class="col">
          <div class="card menu-item shadow-sm h-100 text-center" onclick="window.location='{% url 'mantenimiento:maintenance_dashboard' %}'">
            <div class="card-body">
              <i class="fa-solid fa-screwdriver-wrench fa-2x mb-2"></i>
              <div>Ficha de Mantenimiento</div>
            </div>
          </div>
        </div>
        {% endif %}
        {% if show_citas_bl %}
        <div class="col">
          <div class="card menu-item shadow-sm h-100 text-center" onclick="window.location='{% url 'dashboard_bl' %}'">
            <div class="card-body">
              <i class="fa-solid fa-calendar-check fa-2x mb-2"></i>
              <div>Citas BL</div>
            </div>
          </div>
        </div>
        {% endif %}
        {% if show_citas_col %}
        <div class="col">
          <div class="card menu-item shadow-sm h-100 text-center" onclick="window.location='{% url 'dashboard_col' %}'">
            <div class="card-body">
              <i class="fa-solid fa-calendar-days fa-2x mb-2"></i>
              <div>Citas COL/VOC</div>
            </div>
          </div>
        </div>
        {% endif %}
        {% if show_sponsors %}
        <div class="col">
          <div class="card menu-item shadow-sm h-100 text-center" onclick="window.location='{% url 'sponsors:sponsors_dashboard' %}'">
            <div class="card-body">
              <i class="fa-solid fa-hand-holding-heart fa-2x mb-2"></i>
              <div>Sponsors</div>
            </div>
          </div>
        </div>
        {% endif %}
        {% if show_enfermeria %}
        <div class="col">
          <div class="card menu-item shadow-sm h-100 text-center" onclick="window.location='{% url 'enfermeria:enfermeria_dashboard' %}'">
            <div class="card-body">
              <i class="fa-solid fa-notes-medical fa-2x mb-2"></i>
              <div>Enfermería</div>
            </div>
          </div>
        </div>
        {% endif %}
        {% if show_seguridad %}
        <div class="col">
          <div class="card menu-item shadow-sm h-100 text-center" onclick="window.location='{% url 'seguridad:dashboard' %}'">
            <div class="card-body">
              <i class="fa-solid fa-shield-halved fa-2x mb-2"></i>
              <div>Seguridad</div>
            </div>
          </div>
        </div>
        {% endif %}
        {% if show_coordinador_bilingue %}
        <div class="col">
          <div class="card menu-item shadow-sm h-100 text-center" onclick="window.location='{% url 'dashboard_coordinador' area='bilingue' %}'">
            <div class="card-body">
              <i class="fa-solid fa-chalkboard-user fa-2x mb-2"></i>
              <div>Coord. Bilingüe</div>
            </div>
          </div>
        </div>
        {% endif %}
        {% if show_coordinador_colegio %}
        <div class="col">
          <div class="card menu-item shadow-sm h-100 text-center" onclick="window.location='{% url 'dashboard_coordinador' area='colegio' %}'">
            <div class="card-body">
              <i class="fa-solid fa-user-tie fa-2x mb-2"></i>
              <div>Coord. Colegio</div>
            </div>
          </div>
        </div>
        {% endif %}
      </div>
    </div>
    <!-- /Menú principal -->

    <div class="footer">
      © {{ year }} Soporte Técnico – Asociación Nuevo Amanecer. Todos los derechos reservados.
    </div>
  </div>
</div>
<!-- Bootstrap Bundle JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/js/all.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11" defer></script>
<script>const NOTIFICATIONS_URL = "{% url 'check_new_notifications' %}";</script>
<script src="{% static 'accounts/js/menu.js' %}" defer></script>
</body>
</html>
