{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel Principal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="icon" href="{% static 'accounts/img/nuevo.ico' %}">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <link rel="stylesheet" href="{% static 'accounts/css/menu.css' %}">

  <style>
      .main-card {
          border-radius: 14px;
          padding: 22px;
          color: white;
          height: 150px;
      }
      .main-card h3 {
          margin-top: 5px;
          font-size: 34px;
          font-weight: bold;
      }
      .menu-item { cursor: pointer; transition: .15s; }
      .menu-item:hover { transform: scale(1.03); }

      .card-tickets { background:#0d6efd; }
      .card-citas-bl { background:#198754; }
      .card-citas-col { background:#f1c40f; color:#000; }
      .card-coord-bl { background:#00c2ff; }
      .card-coord-col { background:#6c757d; }
      .card-reloj { background:#111; }
  </style>
</head>

<body class="bg-light">

<div class="d-flex" id="wrapper">

  <!-- ===========================================================
       SIDEBAR
  ============================================================ -->
  <nav class="bg-dark text-white sidebar flex-shrink-0 p-3" style="min-width:230px;">
    <div class="d-flex align-items-center mb-3">
      <img src="{% static 'accounts/img/ana-transformed.png' %}" width="42" class="me-2">
      <span class="fs-5 fw-bold">TechCare</span>
    </div>

    <hr class="text-secondary">

    <ul class="nav nav-pills flex-column mb-auto">

      {% if show_tickets %}
      <li><a href="{% url 'technician_dashboard' %}" class="nav-link text-white">
        <i class="fa-solid fa-ticket me-2"></i> Tickets</a>
      </li>
      {% endif %}

      {% if show_reloj %}
      <li><a href="{% url 'reloj_dashboard' %}" class="nav-link text-white">
        <i class="fa-solid fa-clock me-2"></i> Reloj</a>
      </li>
      {% endif %}

      {% if show_inventory %}
      <li>
        <a class="nav-link text-white d-flex justify-content-between align-items-center"
           data-bs-toggle="collapse" href="#submenuInventario">
          <span><i class="fa-solid fa-boxes-stacked me-2"></i> Inventario</span>
          <i class="fa fa-angle-down"></i>
        </a>
        <div class="collapse" id="submenuInventario">
          <ul class="list-unstyled ps-4">
            <li><a href="{% url 'inventario:dashboard' %}" class="nav-link text-white">
              <i class="fa-regular fa-circle me-2"></i> Dashboard Inventario</a></li>
          </ul>
        </div>
      </li>
      {% endif %}

      {% if show_sponsors %}
      <li>
        <a class="nav-link text-white d-flex justify-content-between align-items-center"
           data-bs-toggle="collapse" href="#submenuSponsors">
          <span><i class="fa-solid fa-hand-holding-heart me-2"></i> Sponsors</span>
          <i class="fa fa-angle-down"></i>
        </a>
        <div class="collapse" id="submenuSponsors">
          <ul class="list-unstyled ps-4">
            <li><a href="{% url 'sponsors:sponsors_dashboard' %}" class="nav-link text-white">
              <i class="fa-regular fa-circle me-2"></i> Dashboard Sponsors</a></li>
          </ul>
        </div>
      </li>
      {% endif %}

      {% if show_seguridad %}
      <li>
        <a class="nav-link text-white d-flex justify-content-between align-items-center"
           data-bs-toggle="collapse" href="#submenuSeguridad">
          <span><i class="fa-solid fa-shield-halved me-2"></i> Seguridad</span>
          <i class="fa fa-angle-down"></i>
        </a>
        <div class="collapse" id="submenuSeguridad">
          <ul class="list-unstyled ps-4">
            <li><a href="{% url 'seguridad:dashboard' %}" class="nav-link text-white">
              <i class="fa-regular fa-circle me-2"></i> Dashboard Seguridad</a></li>
          </ul>
        </div>
      </li>
      {% endif %}

      {% if show_enfermeria %}
      <li>
        <a class="nav-link text-white d-flex justify-content-between align-items-center"
           data-bs-toggle="collapse" href="#submenuEnfermeria">
          <span><i class="fa-solid fa-notes-medical me-2"></i> Enfermería</span>
          <i class="fa fa-angle-down"></i>
        </a>
        <div class="collapse" id="submenuEnfermeria">
          <ul class="list-unstyled ps-4">
            <li><a href="{% url 'enfermeria:enfermeria_dashboard' %}" class="nav-link text-white">
              <i class="fa-regular fa-circle me-2"></i> Panel Enfermería</a></li>
          </ul>
        </div>
      </li>
      {% endif %}

      {% if show_maintenance %}
      <li><a href="{% url 'mantenimiento:maintenance_dashboard' %}" class="nav-link text-white">
        <i class="fa-solid fa-screwdriver-wrench me-2"></i> Mantenimiento
      </a></li>
      {% endif %}

      {% if show_citas_bl %}
      <li><a href="{% url 'dashboard_bl' %}" class="nav-link text-white">
        <i class="fa-solid fa-calendar-check me-2"></i> Citas BL</a></li>
      {% endif %}

      {% if show_citas_col %}
      <li><a href="{% url 'dashboard_col' %}" class="nav-link text-white">
        <i class="fa-solid fa-calendar-days me-2"></i> Citas COL/VOC</a></li>
      {% endif %}

      {% if show_coordinador_bilingue %}
      <li><a href="{% url 'dashboard_coordinador' area='bilingue' %}" class="nav-link text-white">
        <i class="fa-solid fa-chalkboard-user me-2"></i> Coord. BL</a></li>
      {% endif %}

      {% if show_coordinador_colegio %}
      <li><a href="{% url 'dashboard_coordinador' area='colegio' %}" class="nav-link text-white">
        <i class="fa-solid fa-user-tie me-2"></i> Coord. Colegio</a></li>
      {% endif %}

    </ul>

    <hr class="text-secondary">
    <div class="dropdown">
      <a class="d-flex align-items-center text-white text-decoration-none dropdown-toggle" data-bs-toggle="dropdown">
        <img src="{% static 'accounts/img/user.png' %}" width="32" class="rounded-circle me-2">
        <strong>{{ request.user.username }}</strong>
      </a>
      <ul class="dropdown-menu dropdown-menu-dark shadow">
        <li><a class="dropdown-item" href="{% url 'admin:index' %}">
          <i class="fa fa-cog me-2"></i> Admin</a></li>
        <li><hr class="dropdown-divider"></li>
        <li><a class="dropdown-item" href="{% url 'logout' %}">
          <i class="fa fa-sign-out-alt me-2"></i> Cerrar Sesión</a></li>
      </ul>
    </div>

  </nav>

  <!-- ===========================================================
       CONTENIDO PRINCIPAL
  ============================================================ -->
  <div class="flex-grow-1 d-flex flex-column min-vh-100">

    <!-- Header -->
    <nav class="navbar navbar-light bg-white shadow-sm px-3">
      <span class="fs-4">Panel Principal</span>

      <!-- Campanita -->
      <div class="dropdown">
        <a id="notifDropdownToggle" data-bs-toggle="dropdown" class="position-relative">
          <i class="fa-solid fa-bell fa-lg"></i>
          <span id="badgeNotificaciones"
                class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger d-none">0</span>
        </a>
        <ul class="dropdown-menu dropdown-menu-end p-0" style="min-width:350px; max-height:360px; overflow:auto;">
          <li><div class="dropdown-header border-bottom bg-light fw-bold">Notificaciones recientes</div></li>
          <ul id="listaNotificaciones" class="list-unstyled"></ul>
        </ul>
      </div>

      <audio id="notifSound" src="{% static 'accounts/sound/notification.mp3' %}" preload="auto"></audio>
    </nav>

   <!-- TARJETAS -->
{% if show_cards %}
<div class="container-fluid mt-4">
    <div class="row g-3">

        <!-- TARJETA: TICKETS -->
        {% if show_tickets %}
        <div class="col-md-4">
            <div class="main-card card-tickets" onclick="abrirModalResumen('tickets')">
                <i class="fa-solid fa-ticket fa-2x"></i>
                <h3 id="card-tickets-total">{{ tickets_pendientes }}</h3>
                <small>Tickets abiertos</small>
            </div>
        </div>
        {% endif %}

        <!-- TARJETA: CITAS BL -->
        {% if show_citas_bl %}
        <div class="col-md-4">
            <div class="main-card card-citas-bl" onclick="abrirModalResumen('citas_bl')">
                <i class="fa-solid fa-calendar-check fa-2x"></i>
                <h3 id="card-citas-bl-total">{{ citas_bl }}</h3>
                <small>Citas BL pendientes</small>
            </div>
        </div>
        {% endif %}

        <!-- TARJETA: CITAS COLEGIO -->
        {% if show_citas_col %}
        <div class="col-md-4">
            <div class="main-card card-citas-col" onclick="abrirModalResumen('citas_col')">
                <i class="fa-solid fa-calendar-days fa-2x"></i>
                <h3 id="card-citas-col-total">{{ citas_col }}</h3>
                <small>Citas Colegio/VOC pendientes</small>
            </div>
        </div>
        {% endif %}

        <!-- TARJETA: REPORTES BL -->
        {% if show_coordinador_bilingue %}
        <div class="col-md-4">
            <div class="main-card card-coord-bl" onclick="abrirModalResumen('coord_bl')">
                <i class="fa-solid fa-person-chalkboard fa-2x"></i>
                <h3 id="card-coord-bl-total">{{ reportes_bl }}</h3>
                <small>Reportes nuevos BL</small>
            </div>
        </div>
        {% endif %}

        <!-- TARJETA: REPORTES COLEGIO -->
        {% if show_coordinador_colegio %}
        <div class="col-md-4">
            <div class="main-card card-coord-col" onclick="abrirModalResumen('coord_col')">
                <i class="fa-solid fa-user-group fa-2x"></i>
                <h3 id="card-coord-col-total">{{ reportes_col }}</h3>
                <small>Reportes nuevos Colegio</small>
            </div>
        </div>
        {% endif %}

        <!-- TARJETA: RELOJ (DESACTIVADA POR AHORA) -->
        <!--
        {% if show_reloj %}
        <div class="col-md-4">
            <div class="main-card card-reloj" onclick="abrirModalResumen('reloj')">
                <i class="fa-solid fa-clock fa-2x"></i>
                <h3 id="card-reloj-total">{{ reloj_pendientes }}</h3>
                <small>Solicitudes pendientes</small>
            </div>
        </div>
        {% endif %}
        -->

    </div>
</div>
{% endif %}

    <!-- GRID DE MÓDULOS -->
    <div class="container my-4 pb-5">
      <div class="row row-cols-2 row-cols-md-4 g-4 justify-content-center">

        {% if show_tickets %}
        <div class="col">
          <div class="card menu-item shadow-sm text-center"
               onclick="location.href='{% url 'technician_dashboard' %}'">
            <div class="card-body">
              <i class="fa-solid fa-ticket fa-2x mb-2"></i> Sistema de Tickets
            </div>
          </div>
        </div>
        {% endif %}

        {% if show_reloj %}
        <div class="col">
          <div class="card menu-item shadow-sm text-center"
               onclick="location.href='{% url 'reloj_dashboard' %}'">
            <div class="card-body">
              <i class="fa-solid fa-clock fa-2x mb-2"></i> Reloj
            </div>
          </div>
        </div>
        {% endif %}

        {% if show_inventory %}
        <div class="col">
          <div class="card menu-item shadow-sm text-center"
               onclick="location.href='{% url 'inventario:dashboard' %}'">
            <div class="card-body">
              <i class="fa-solid fa-boxes-stacked fa-2x mb-2"></i> Inventario
            </div>
          </div>
        </div>
        {% endif %}

        {% if show_maintenance %}
        <div class="col">
          <div class="card menu-item shadow-sm text-center"
               onclick="location.href='{% url 'mantenimiento:maintenance_dashboard' %}'">
            <div class="card-body">
              <i class="fa-solid fa-screwdriver-wrench fa-2x mb-2"></i> Mantenimiento
            </div>
          </div>
        </div>
        {% endif %}

        {% if show_citas_bl %}
        <div class="col">
          <div class="card menu-item shadow-sm text-center"
               onclick="location.href='{% url 'dashboard_bl' %}'">
            <div class="card-body">
              <i class="fa-solid fa-calendar-check fa-2x mb-2"></i> Citas BL
            </div>
          </div>
        </div>
        {% endif %}

        {% if show_citas_col %}
        <div class="col">
          <div class="card menu-item shadow-sm text-center"
               onclick="location.href='{% url 'dashboard_col' %}'">
            <div class="card-body">
              <i class="fa-solid fa-calendar-days fa-2x mb-2"></i> Citas COL/VOC
            </div>
          </div>
        </div>
        {% endif %}

        {% if show_sponsors %}
        <div class="col">
          <div class="card menu-item shadow-sm text-center"
               onclick="location.href='{% url 'sponsors:sponsors_dashboard' %}'">
            <div class="card-body">
              <i class="fa-solid fa-hand-holding-heart fa-2x mb-2"></i> Sponsors
            </div>
          </div>
        </div>
        {% endif %}

        {% if show_enfermeria %}
        <div class="col">
          <div class="card menu-item shadow-sm text-center"
               onclick="location.href='{% url 'enfermeria:enfermeria_dashboard' %}'">
            <div class="card-body">
              <i class="fa-solid fa-notes-medical fa-2x mb-2"></i> Enfermería
            </div>
          </div>
        </div>
        {% endif %}

        {% if show_seguridad %}
        <div class="col">
          <div class="card menu-item shadow-sm text-center"
               onclick="location.href='{% url 'seguridad:dashboard' %}'">
            <div class="card-body">
              <i class="fa-solid fa-shield-halved fa-2x mb-2"></i> Seguridad
            </div>
          </div>
        </div>
        {% endif %}

        {% if show_coordinador_bilingue %}
        <div class="col">
          <div class="card menu-item shadow-sm text-center"
               onclick="location.href='{% url 'dashboard_coordinador' area='bilingue' %}'">
            <div class="card-body">
              <i class="fa-solid fa-chalkboard-user fa-2x mb-2"></i> Coord. BL
            </div>
          </div>
        </div>
        {% endif %}

        {% if show_coordinador_colegio %}
        <div class="col">
          <div class="card menu-item shadow-sm text-center"
               onclick="location.href='{% url 'dashboard_coordinador' area='colegio' %}'">
            <div class="card-body">
              <i class="fa-solid fa-user-tie fa-2x mb-2"></i> Coord. Colegio
            </div>
          </div>
        </div>
        {% endif %}

      </div>
    </div>

    <footer class="text-center py-3">
      © {{ year }} Soporte Técnico – Asociación Nuevo Amanecer.
    </footer>
  </div>

</div>


<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="{% static 'accounts/js/notifications.js' %}"></script>
<script src="{% static 'accounts/js/dashboard_summary.js' %}"></script>

</body>
</html>
