{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Reporte Tiempo por Hora</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css" rel="stylesheet"/>

  <style>
    .hora-rojo  { background: #f8d7da !important; color: #842029 !important; font-weight: 600; }
    .hora-verde { background: #d1e7dd !important; color: #0f5132 !important; font-weight: 600; }
    .hora-azul  { background: #3b8eea !important; color: #fff !important;   font-weight: 600; }
  </style>
</head>
<body class="bg-light">

<div class="container py-4">
  <h2 class="mb-3">Reporte Tiempo por Hora</h2>

  {% if error %}
    <div class="alert alert-danger">{{ error }}</div>
  {% endif %}

  <div class="table-responsive">
    <table id="tablaTiempoPorHora" class="table table-bordered table-striped align-middle w-100">
      <thead class="table-light">
        <tr>
          <th>ID Empleado</th>
          <th>Empleado</th>
          <th>Fecha</th>
          <th>Hora Entrada</th>
          <th>Hora Salida</th>
          <th>Cantidad Marcas</th>
          <th>Tiempo Extra</th>
          <th>Tiempo Faltante</th>
        </tr>
      </thead>
      <tbody>
        {% if datos %}
          {% for row in datos %}
          <tr class="data-row">
            <td>{{ row.ID_Empleado }}</td>
            <td>{{ row.Empleado }}</td>
            <td>{{ row.Fecha|date:"Y-m-d" }}</td>
            <td class="{{ row.Color_Entrada_Class }}">{{ row.Hora_Entrada }}</td>
            <td class="{{ row.Color_Salida_Class  }}">{{ row.Hora_Salida }}</td>
            <td>{{ row.Cantidad_Marcas|default:"0" }}</td>
            <td>
              {% if row.Tiempo_Extra %}
                <span class="badge bg-primary">{{ row.Tiempo_Extra }}</span>
              {% else %}—{% endif %}
            </td>
            <td>
              {% if row.Tiempo_Faltante %}
                <span class="badge bg-danger">{{ row.Tiempo_Faltante }}</span>
              {% else %}—{% endif %}
            </td>
          </tr>
          {% endfor %}
        {% else %}
          <tr>
            <!-- OJO: colspan = número de <th> -->
            <td colspan="8" class="text-center text-muted py-3">No hay registros disponibles.</td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </div>

  <a href="{% url 'reloj_dashboard' %}" class="btn btn-outline-secondary mt-2">Volver a Reloj</a>
</div>

<!-- JS: jQuery antes de DataTables -->
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
<script>
  (function(){
    var $t = $('#tablaTiempoPorHora');
    var hasRows = $t.find('tbody tr.data-row').length > 0;

    if ($.fn.DataTable.isDataTable($t)) {
      $t.DataTable().destroy();
    }

    if (hasRows) {
      $t.DataTable({
        pageLength: 25,
        lengthChange: false,
        ordering: true,
        searching: true,
        deferRender: true,
        responsive: true,
        language: {
          lengthMenu: "Mostrar _MENU_ registros",
          zeroRecords: "No hay registros",
          info: "Mostrando _START_ a _END_ de _TOTAL_",
          infoEmpty: "No hay registros disponibles",
          infoFiltered: "(filtrado de _MAX_ registros totales)",
          search: "Buscar:",
          paginate: { first: "Primero", last: "Último", next: "Siguiente", previous: "Anterior" }
        }
      });
    } else {
      console.warn('DataTables no se inicializa porque la tabla no tiene filas de datos.');
    }
  })();
</script>
</body>
</html>
